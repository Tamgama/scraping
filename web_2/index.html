<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de CSV con Paginación y Formato Personalizado</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .card-custom {
            width: 100%;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .card-custom h4 {
            margin-bottom: 10px;
            font-size: 1.5rem;
        }
        .separator {
            height: 1px;
            background-color: #ddd;
            margin: 10px 0;
        }
        .row-custom {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .row-custom .col-custom {
            flex: 1 1 45%; /* Se adapta mejor en pantallas pequeñas */
            margin-bottom: 10px;
        }
        .btn-custom {
            margin-top: 10px;
            width: 100%;
        }
        .badge-container {
            margin-bottom: 10px;
        }
        .badge-custom {
            background-color: #007bff;
            color: white;
            margin-right: 5px;
            margin-bottom: 5px;
            font-size: 0.75rem; /* Tamaño de texto reducido */
            padding: 3px 7px;    /* Tamaño del padding reducido */
            border-radius: 4px;
            display: inline-block;
        }
        .form-control-custom {
            margin-bottom: 20px;
        }

        @media (max-width: 576px) {
            .row-custom .col-custom {
                flex: 1 1 100%; /* En móviles ocupa el 100% del ancho */
                margin-bottom: 5px;
            }
            .card-custom h4 {
                font-size: 1.2rem; /* Ajuste del tamaño de fuente en móviles */
            }
        }
    </style>
</head>
<body>

<div class="container mt-5">
    <h1 class="text-center">Visualizador de CSV con Paginación</h1>

    <div class="form-group">
        <label for="csvFileInput">Cargar archivo CSV</label>
        <input type="file" class="form-control-file" id="csvFileInput" accept=".csv">
    </div>

    <!-- Campo de búsqueda -->
    <div class="form-group">
        <input type="text" id="searchTitle" class="form-control form-control-custom" placeholder="Buscar por título...">
    </div>

    <!-- Contenedor para paginación -->
    <div id="paginationControls" class="mb-3">
        <button id="prevPage" class="btn btn-primary" disabled>Anterior</button>
        <span id="pageInfo" class="mx-2">Página 1</span>
        <button id="nextPage" class="btn btn-primary" disabled>Siguiente</button>
    </div>

    <div id="cardsContainer" class="row">
        <!-- Contenedor para las cards -->
    </div>
</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<!-- Bootstrap JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<!-- PapaParse JS (para parsear CSV) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<!-- Lodash JS -->
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>

<script>
    $(document).ready(function () {
        var data = [];
        var filteredData = [];
        var pageSize = 10;
        var currentPage = 1;
        var totalPages = 0;

        // Cargar el archivo CSV
        $('#csvFileInput').on('change', function (event) {
            var file = event.target.files[0];

            if (file) {
                Papa.parse(file, {
                    header: true,
                    dynamicTyping: true,
                    complete: function (results) {
                        data = results.data;
                        filteredData = data; // Inicialmente, sin filtrar
                        totalPages = Math.ceil(filteredData.length / pageSize);
                        renderPage(currentPage);
                        updatePaginationControls();
                    }
                });
            }
        });

        // Filtro por título
        $('#searchTitle').on('input', function () {
            var searchTerm = $(this).val().toLowerCase();
            filteredData = data.filter(function (row) {
                return row['Título'] && row['Título'].toLowerCase().includes(searchTerm);
            });
            currentPage = 1;
            totalPages = Math.ceil(filteredData.length / pageSize);
            renderPage(currentPage);
            updatePaginationControls();
        });

        // Paginación
        $('#prevPage').on('click', function () {
            if (currentPage > 1) {
                currentPage--;
                renderPage(currentPage);
                updatePaginationControls();
            }
        });

        $('#nextPage').on('click', function () {
            if (currentPage < totalPages) {
                currentPage++;
                renderPage(currentPage);
                updatePaginationControls();
            }
        });

        function renderPage(page) {
            $('#cardsContainer').empty();
            var start = (page - 1) * pageSize;
            var end = start + pageSize;
            var pageData = _.slice(filteredData, start, end);

            pageData.forEach(function (row) {
                var card = $('<div class="col-12 mb-4"></div>');
                var cardContent = '<div class="card-custom">';
                cardContent += '<h4>' + (row['Título'] || 'Título desconocido') + '</h4>'; // Título en la parte superior

                cardContent += '<div class="separator"></div>';

                cardContent += '<div class="row-custom">';
                cardContent += '<div class="col-custom"><strong>Precio:</strong> ' + (row['Precio'] || 'N/A') + '</div>';
                cardContent += '<div class="col-custom"><strong>Precio/m²:</strong> ' + (row['Precio/m²'] || 'N/A') + '</div>';
                cardContent += '</div>';

                cardContent += '<div class="row-custom">';
                cardContent += '<div class="col-custom"><strong>Superficie:</strong> ' + (row['Superficie'] || 'N/A') + '</div>';
                cardContent += '<div class="col-custom"><strong>Última Actualización:</strong> ' + (row['Última Actualización'] || 'N/A') + '</div>';
                cardContent += '</div>';

                // Añadir características como badges
                if (row['Características']) {
                    cardContent += '<div class="badge-container">';
                    var caracteristicas = row['Características'];

                    // Eliminar corchetes, comillas simples y dividir en elementos separados por comas
                    caracteristicas = caracteristicas.replace(/^\[|\]$/g, '').split(',');
                    caracteristicas.forEach(function(caracteristica) {
                        // Eliminar comillas simples y espacios adicionales
                        caracteristica = caracteristica.replace(/'/g, '').trim();
                        cardContent += '<span class="badge-custom">' + caracteristica + '</span>';
                    });

                    cardContent += '</div>';
                }

                // Añadir el botón con la URL
                if (row['URL']) {
                    cardContent += '<a href="' + row['URL'] + '" target="_blank" class="btn btn-primary btn-custom">Ver Inmueble</a>';
                }

                cardContent += '</div>';
                card.append(cardContent);

                $('#cardsContainer').append(card);
            });
        }

        function updatePaginationControls() {
            $('#pageInfo').text('Página ' + currentPage + ' de ' + totalPages);
            $('#prevPage').prop('disabled', currentPage === 1);
            $('#nextPage').prop('disabled', currentPage === totalPages);
        }
    });
</script>

</body>
</html>
